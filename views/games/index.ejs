<%- include('../partials/header.ejs') %>

<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h1><%= pageOwner.username %>'s Backlog</h1>
    <% if (user && user.id == pageOwner.id) { %>
      <a href="/users/<%= pageOwner.id %>/games/new" class="btn btn-primary">Add a Game</a>
    <% } %>
  </div>

  <% const statusOrder = ['In Progress', 'Pending', 'Completed', 'Dropped']; %>
  <% let totalGames = 0; %>

  <% statusOrder.forEach(status => { %>
    <% const games = gamesByStatus[status]; %>
    <% totalGames += games.length; %>
    <% if (games && games.length > 0) { %>
      <h2 class="mt-4"><%= status %> <span class="badge bg-primary"><%= games.length %></span></h2>
      <hr>
      <div class="row row-cols-2 row-cols-sm-3 row-cols-md-4 row-cols-lg-5 row-cols-xl-6 g-4">
        <% games.forEach(game => { %>
          <div class="col">
            <a href="/users/<%= pageOwner.id %>/games/<%= game.id %>" class="game-portrait-card">
              <% if (game.boxArt) { %>
                <img src="<%= game.boxArt %>" alt="<%= game.title %> box art" class="game-portrait-img">
              <% } else { %>
                <div class="game-portrait-img-placeholder">
                  <span><%= game.title %></span>
                </div>
              <% } %>
              <div class="game-portrait-overlay">
                <h6 class="game-portrait-title" title="<%= game.title %>"><%= game.title %></h6>
                <% if (game.rating) { %>
                  <div class="game-portrait-rating">
                    <span class="visually-hidden"><%= game.rating %> out of 5 stars</span>
                    <span class="rating-star-filled"><%= '★'.repeat(game.rating) %></span><span class="rating-star-empty"><%= '★'.repeat(5 - game.rating) %></span>
                  </div>
                <% } %>
                </div>
            </a>
          </div>
        <% }); %>
      </div>
    <% } %>
  <% }); %>

  <% if (totalGames === 0) { %>
    <div class="alert alert-info mt-4">Your backlog is empty. <a href="/users/<%= pageOwner.id %>/games/new">Add your first game!</a></div>
  <% } %>
</div>

<%- include('../partials/footer.ejs') %>
