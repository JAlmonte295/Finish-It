<%- include('../partials/header.ejs') %>

<div class="container mt-4">
  <h1>Community Backlogs</h1>
  <p>See what other gamers are planning to play.</p>
  <hr>



  <% if (users.length > 0) { %>
    <div class="row row-cols-1 row-cols-lg-2 g-4">
      <% users.forEach(user => { %>
        <% if ((user.games && user.games.length > 0) && (!locals.user || locals.user.id != user._id.toString())) { %>
          <div class="col">
            <div class="card h-100">
              <div class="card-body d-flex flex-column">
                <div class="flex-grow-1">
                  <h5 class="card-title mb-3"><%= user.username %></h5>
                  <% if (user.latestGame) { %>
                    <p class="card-text text-muted small mb-1">Recently Added:</p>
                    <div class="d-flex align-items-center">
                      <% if (user.latestGame.boxArt) { %>
                        <img src="<%= user.latestGame.boxArt %>" alt="<%= user.latestGame.title %>" class="community-game-art me-3">
                      <% } %>
                      <div>
                        <strong class="d-block"><%= user.latestGame.title %></strong>
                        <% if (user.latestGame.rating) { %>
                          <small><span class="visually-hidden"><%= user.latestGame.rating %> out of 5 stars</span>
                          <span class="rating-star-filled" aria-hidden="true"><%= '★'.repeat(user.latestGame.rating) %></span><span class="rating-star-empty" aria-hidden="true"><%= '★'.repeat(5 - user.latestGame.rating) %></span>
                          </small>
                        <% } %>
                      </div>
                    </div>
                  <% } else { %>
                    <p class="card-text"><%= user.games.length %> game(s) in backlog.</p>
                  <% } %>
                  </div>
                <a href="/users/<%= user._id %>/games" class="btn btn-outline-primary mt-3 align-self-start">View Backlog</a>
              </div>
            </div>
          </div>
        <% } %>
      <% }); %>
    </div>
  <% } else { %>
    <p>No other users in the community yet.</p>
  <% } %>
  <hr>


    <% if (!user) { %>
    <div class="alert alert-info" role="alert">
      <h4 class="alert-heading">Join the Community!</h4>
      <p>Want to create and share your own game backlog? It's easy! Sign up to start tracking the games you want to finish.</p>
      <a href="/auth/sign-up" class="btn btn-primary">Sign Up Now</a>
    </div>
  <% } %>

</div>

<%- include('../partials/footer.ejs') %>